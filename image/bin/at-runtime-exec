#!/bin/bash
set -eo pipefail
. "$IMAGE_ROOT/lib.sh"

runtimed="${RUNTIME_DEFERRED:?}"

stamp_started="${runtimed}/.started"
stamp_done="${runtimed}/.done"

if [[ -e "$stamp_started" ]]; then
	debug "Stamp %s already exists; exiting quietly."
	exit 0
fi

e "Running any deferred at-runtime tasks from %s" "$runtimed"

touch "$stamp_started"

run-parts --verbose --exit-on-error "${runtimed}"

touch "$stamp_done"

debug "Done running deferred at runtime tasks from %s" "$runtimed"
